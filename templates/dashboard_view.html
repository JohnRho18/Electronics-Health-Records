<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EHR Dashboard Mockup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="logo">Electronic Health Records</div>

            <div class="user-actions">
                <div class="user-role-display">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#007bff">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <span>{{ current_user.role|capitalize }}</span>
                </div>
                <a href="{{ url_for('add_patient') }}" class="btn-header" style="margin-left: 10px;">
                    + Add Patient
                </a>
                <a href="{{ url_for('logout') }}" class="btn-header" style="background-color: #dc3545; margin-left: 10px;">
                    Logout
                </a>
            </div>
        </div>

        <div class="card patients-list">
            <h2>Electronic Health Records</h2>
            {% for patient in patients %}
            <a href="{{ url_for('dashboard', patient_id=patient.id) }}" style="text-decoration: none; color: inherit;">
                <div class="patient-item {% if selected_patient and patient.id == selected_patient.id %}active{% endif %}">
                    <div class="patient-avatar">{{ patient.name[0] }}</div>
                    <div class="patient-info">
                        <strong>{{ patient.name }}</strong>
                        <small>Last Visit: {{ patient.visit_date.strftime('%b %d, %Y') }}</small>
                    </div>
                </div>
            </a>
            {% endfor %}
            {% if not patients %}
            <p style="text-align: center; color: #6c757d; padding: 20px;">No patients found. Use the "+ Add Patient" button above to get started.</p>
            {% endif %}
        </div>

        <div class="card patient-details">
            {% if selected_patient %}
                <div style="text-align: center;">
                    <div class="detail-photo" title="{{ selected_patient.name }}"></div>
                    <h3 style="margin-bottom: 0;">{{ selected_patient.name }} ({{ selected_patient.age }} y/o)</h3>
                    <small style="color: #6c757d;">Gender: {{ selected_patient.gender }} | Visit: {{ selected_patient.visit_date.strftime('%b %d, %Y') }}</small>
                </div>
                <div class="detail-info" style="margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px;">
                        <strong style="font-size: 1.1rem;">Visit History</strong>
                        <div style="font-size: 0.9rem; color: #007bff; border: 1px solid #ddd; padding: 5px 10px; border-radius: 6px;">Last Year</div>
                    </div>

                    <p style="color: #6c757d; font-size: 0.9rem;">Patient clinical history data would be displayed here.</p>

                    <button class="btn-primary" style="margin-top: 30px;">Download record</button>

                    <form method="POST" action="{{ url_for('delete_patient', patient_id=selected_patient.id) }}" onsubmit="return confirm('WARNING: Are you sure you want to delete {{ selected_patient.name }} and ALL their records? This cannot be undone.');">
                        <button type="submit" class="btn-primary" style="background-color: #dc3545;">
                            Delete Patient Record
                        </button>
                    </form>

                </div>
            {% else %}
                <p>No patient selected. Please add a patient to begin viewing their details.</p>
            {% endif %}
        </div>

        <div class="card prescriptions">
            <h2>Electronic Prescriptions</h2>
            {% if selected_patient %}
                <p style="color: #6c757d; margin-top: -10px; margin-bottom: 20px;">{{ prescriptions|length }} Active prescriptions</p>
            {% else %}
                <p style="color: #6c757d; margin-top: -10px; margin-bottom: 20px;">Select a patient to view their prescriptions.</p>
            {% endif %}

            {% for rx in prescriptions %}
            <div class="prescription-item">
                <div style="flex-grow: 1;">
                    <strong>{{ rx.medication }}</strong>
                    <small>Dosage: {{ rx.dosage }}</small>
                    <small>Instructions: {{ rx.instructions }}</small>
                </div>
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 5px;">
                    <a href="{{ url_for('edit_prescription', rx_id=rx.id) }}" class="btn-elab" style="background-color: #e0f2ff; color: #007bff; border-color: #cce9ff;">Edit</a>
                    <form method="POST" action="{{ url_for('delete_prescription', rx_id=rx.id) }}" style="margin: 0;" onsubmit="return confirm('Are you sure you want to delete this prescription?');">
                        <button type="submit" class="btn-elab" style="background-color: #ffe6e6; color: #dc3545; border-color: #ffcccc;">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}

            {% if selected_patient %}
            <a href="{{ url_for('add_prescription', patient_id=selected_patient.id) }}" class="btn-primary-ghost">
                + New Prescription
            </a>
            {% endif %}
        </div>

        <div class="card calendar-card">
            <h2>Calendar</h2>
            <p style="color: #6c757d; margin-top: -10px;">{{ calendar_data.month_name }}</p>
            <div class="calendar-grid">
                <div class="day-header">S</div><div class="day-header">M</div><div class="day-header">T</div><div class="day-header">W</div><div class="day-header">T</div><div class="day-header">F</div><div class="day-header">S</div>

                {% for day in calendar_data.days %}
                <div class="day-cell {% if day.is_today %}today{% endif %} {% if day.class == 'empty' %}empty-cell{% endif %}">
                    {{ day.day }}
                </div>
                {% endfor %}

            </div>
        </div>

        <div class="card telehealth">
            <h2>Telehealth</h2>
            <button class="btn-primary-ghost-blue">Virtual Appointment</button>
            {% if selected_patient and appointments %}
                {% for appt in appointments %}
                <div class="appointment-item">
                    <div class="appointment-info">
                        <strong>{{ selected_patient.name }}</strong>
                        <small>{{ appt.appointment_time }} | {{ appt.provider_detail }}</small>
                    </div>
                    <span class="status-badge status-scheduled">{{ appt.status }}</span>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #6c757d; font-size: 0.9rem;">No scheduled telehealth appointments for this patient.</p>
            {% endif %}
        </div>

        <div class="card labs">
            <h2>Electronic Labs</h2>
            {% if all_pending_labs %}
                {% for lab in all_pending_labs %}
                <div class="lab-item">
                    <div class="appointment-info">
                        <strong style="color: #007bff;">{{ lab.patient.name }}</strong>
                        <small>Order: {{ lab.order_type }}</small>
                        <small>Ordered by: {{ lab.ordered_by }}</small>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-end;">
                        <span class="status-badge status-needs-submission" style="margin-bottom: 5px;">{{ lab.status }}</span>
                        <button class="btn-elab" style="background-color: #e0f2ff; color: #007bff; border-color: #cce9ff;">Create eLab</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #6c757d; font-size: 0.9rem;">No pending lab orders.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>